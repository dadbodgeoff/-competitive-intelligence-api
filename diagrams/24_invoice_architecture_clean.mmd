```mermaid
%%{init: {'theme':'base', 'themeVariables': { 'primaryColor':'#10B981','primaryTextColor':'#fff','primaryBorderColor':'#059669','lineColor':'#6366F1','secondaryColor':'#3B82F6','tertiaryColor':'#F59E0B','fontSize':'15px'}}}%%

graph TB
    subgraph Client["üñ•Ô∏è CLIENT - Instant Response"]
        A[Upload PDF]
        B[SSE Stream]
        C[User Review]
    end
    
    subgraph Security["üîí SECURITY - 470ms"]
        D[HTTPOnly Cookies]
        E[Malware Scan]
        F[Row Level Security]
    end
    
    subgraph AI["ü§ñ AI PROCESSING - 30-64s"]
        G[Gemini 2.5 Flash]
        H[Extract 15 Items]
        I[Validation]
    end
    
    subgraph Database["üíæ SOURCE OF TRUTH - 723ms<br/>invoice_items table"]
        J[ACID Transaction]
        K[Fuzzy Match 85%]
        L[Save Header + Items]
    end
    
    subgraph Analytics["üìà ANALYTICS - 60-270ms<br/>Read-Only Queries"]
        M[Query invoice_items]
        N[Calculate Metrics]
        O[Cross-Vendor Compare]
    end
    
    A --> D
    D --> E
    E --> G
    G --> H
    H --> I
    I --> B
    B --> C
    C -->|User Saves| J
    J --> K
    K --> L
    L -.->|Read-Only| M
    M --> N
    N --> O
    F -.->|Enforces| L
    
    Result[["‚ú® COMPLETE<br/>~65s total | $0.0006 cost<br/>15 items in invoice_items"]]
    O --> Result
    
    style Client fill:#4F46E5,stroke:#4338CA,stroke-width:3px,color:#fff
    style Security fill:#EF4444,stroke:#DC2626,stroke-width:3px,color:#fff
    style AI fill:#10B981,stroke:#059669,stroke-width:3px,color:#fff
    style Database fill:#3B82F6,stroke:#2563EB,stroke-width:3px,color:#fff
    style Analytics fill:#EC4899,stroke:#DB2777,stroke-width:3px,color:#fff
    style Result fill:#8B5CF6,stroke:#7C3AED,stroke-width:4px,color:#fff
```
